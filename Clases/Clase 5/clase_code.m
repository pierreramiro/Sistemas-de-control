%% ensayo dinamico
clc;
clear;
close all;

vel=[0 0 0 0 0 99.31 113.77 129.49 139.09 156.25 164.47 174.26 186.75 191.33 205.59 210.20 225.36 227.55 230.91 228.66 246.71 252.02 253.38 261.87 264.83 266.34 275.74 285.82 277.37 287.58 287.58 294.81 296.68 302.42 298.57 298.57 306.37 308.39 312.50 308.39 314.60 310.43 334.82 314.60 312.50 321.06 325.52 332.45 325.52 325.52 323.28 332.45 337.23 332.45 332.45 334.82 334.82 339.67 334.82 334.82 342.15 337.23 339.67 330.11 339.67 339.67 339.67 339.67 332.45 347.22 349.81 339.67 342.15 344.67 347.22 339.67 342.15 334.82 344.67 334.82 347.22 321.06 344.67 344.67 344.67 344.67 355.11 355.11 349.81 349.81 347.22 349.81 355.11 357.82 352.44 349.81 349.81 349.81 349.81 349.81 355.11 352.44 349.81 349.81 339.67 352.44 352.44 337.23 352.44 352.44 344.67 349.81 352.44 360.58 357.82 352.44 352.44 352.44 349.81 355.11 360.58 360.58 337.23 352.44 352.44 325.52 355.11 357.82 357.82 355.11 355.11 352.44 352.44 352.44 352.44 357.82 357.82 352.44 344.67 352.44 355.11 355.11 357.82 357.82 357.82 355.11 352.44 352.44 323.28 355.11 357.82 360.58 357.82 355.11 355.11 355.11 357.82 357.82 363.37 337.23 355.11 355.11 355.11 357.82 357.82 357.82 355.11 355.11 352.44 352.44 357.82 357.82 357.82 355.11 352.44 355.11 342.15 355.11 355.11 349.81 352.44 355.11 355.11 360.58 355.11 355.11 347.22 355.11 355.11 344.67 355.11 352.44 355.11 339.67 355.11 355.11 352.44 352.44 355.11 357.82 360.58 360.58 355.11 360.58 352.44 352.44 344.67 352.44 357.82 323.28 352.44 352.44 352.44 352.44 360.58 360.58 352.44 352.44 325.52 352.44 352.44 360.58 355.11 355.11 352.44 349.81 355.11 355.11 352.44 357.82 357.82 352.44 355.11 352.44 363.37 355.11 357.82 344.67 355.11 352.44 352.44 357.82 355.11 355.11 357.82 352.44 355.11 355.11 357.82 349.81 357.82 327.80 357.82 355.11 352.44 360.58 357.82 357.82 355.11 352.44 355.11 357.82 355.11 355.11 355.11 357.82 360.58 355.11 355.11 355.11 357.82 357.82 357.82 360.58 360.58 357.82 357.82 355.11 357.82 330.11 360.58 360.58 360.58 357.82 352.44 357.82 357.82 366.21 337.23 360.58 363.37 357.82 357.82 357.82 355.11 357.82 363.37 357.82 357.82 357.82 357.82 355.11 355.11 363.37 363.37 363.37 357.82 357.82 357.82 357.82 342.15 366.21 363.37 357.82 357.82 357.82 355.11 357.82 357.82 344.67 363.37 357.82 357.82 355.11 357.82 357.82 360.58 360.58 339.67 355.11 357.82 355.11 349.81 357.82 360.58 360.58 357.82 357.82 355.11 355.11 355.11 357.82 360.58 349.81 357.82 355.11 355.11 357.82 357.82 357.82 357.82 357.82 327.80 355.11 355.11 355.11 330.11 357.82 360.58 357.82 339.67 355.11 357.82 355.11 360.58 360.58 360.58 360.58 363.37 355.11 357.82 357.82 357.82 357.82 360.58 357.82 357.82 355.11 357.82 355.11 366.21 363.37 360.58 357.82 360.58 332.45 357.82 357.82 366.21 366.21 342.15 357.82 360.58 360.58 357.82 360.58 366.21 363.37 360.58 360.58 357.82 357.82 357.82 360.58 360.58 363.37 360.58 357.82 357.82 357.82 357.82 357.82 363.37 363.37 366.21 360.58 360.58 337.23 360.58 369.09 366.21 366.21 360.58 352.44 360.58 360.58 360.58 360.58 363.37 355.11 360.58 360.58 360.58 360.58 360.58 342.15 363.37 363.37 366.21 363.37 360.58 349.81 360.58 357.82 357.82 366.21 366.21 347.22 360.58 360.58 360.58 360.58 363.37 366.21 357.82 363.37 360.58 360.58 360.58 363.37 363.37 363.37 363.37 366.21 369.09 366.21 363.37 363.37 363.37 366.21 366.21 366.21 369.09 357.82 360.58 357.82 363.37 366.21 363.37 372.02 372.02 372.02 366.21 363.37 360.58 352.44 366.21 366.21 369.09 369.09 366.21 369.09 363.37 366.21 360.58 363.37 332.45 352.44 372.02 363.37 363.37 366.21 363.37 366.21 363.37 ];
vel=vel(1:500);
t= 0: 0.002 : 0.999;
u= 3*ones(1,500);
%save('Transfer_function','tf1')
load('Transfer_function')
num=tf1.numerator;
den=tf1.denominator;
Gm=tf(num/den(end),den/den(end));
lsim(Gm,u,t)
hold
plot(t,vel);
hold off
%rltool(Gm)
%% Realizamos el control
%controlador PI
s=tf('s');
zero=8;%tiene que ser mayor, en magnitud, a 4
Gc=(s+zero)/s;
Ts=1;
K=Gm.num{1}(end);
tau=Gm.den{1}(1);
polo_des=-4/Ts;
Kp=(-polo_des*(tau*polo_des+1))/(K*(polo_des+zero));
polos_sistema=rlocus(Gc*Gm,Kp);
disp(polos_sistema)
Ki=4.5*Kp;
Gc=Kp+Ki/s;
%a~nadir los valores de Kp y Ki al bloque del simulink